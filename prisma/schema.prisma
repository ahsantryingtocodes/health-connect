datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            Int      @id @default(autoincrement())
  name          String
  email         String   @unique
  contactNumber String?
  password      String
  role          Role     @default(PATIENT)
  isVerified    Boolean  @default(false) // <--- ADD THIS LINE
  specialization String? // For doctors - stored during registration
  createdAt     DateTime @default(now())

  doctorProfile DoctorProfile?
  appointments  Appointment[]
  doctorPrescriptions  Prescription[] @relation("DoctorPrescriptions")
  patientPrescriptions Prescription[] @relation("PatientPrescriptions")
  patientReviews Review[] @relation("PatientReviews")
  doctorReviews Review[] @relation("DoctorReviews")
}

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}

enum Specialization {
  CARDIOLOGY
  DERMATOLOGY
  PEDIATRICS
  NEUROLOGY
  ORTHOPEDICS
  PSYCHIATRY
  GENERAL_PRACTICE
  ONCOLOGY
}

model DoctorProfile {
  id             Int            @id @default(autoincrement())
  userId         Int            @unique
  specialization Specialization
  availableToday Boolean        @default(false)

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  appointments Appointment[]
}
model Appointment {
  id              Int      @id @default(autoincrement())
  patientId       Int
  doctorProfileId Int
  consultationType String
  date            DateTime
  status          String   @default("PENDING")
  roomId          String?  @unique // Unique room identifier for chat/video

  patient User          @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor  DoctorProfile @relation(fields: [doctorProfileId], references: [id], onDelete: Cascade)

  prescription Prescription?
  review Review?
  createdAt DateTime @default(now())
}

model Prescription {
  id             Int      @id @default(autoincrement())
  appointmentId  Int      @unique
  doctorId       Int
  patientId      Int

  symptoms       String
  advice         String?
  followUpDate   DateTime?
  status         String   @default("DRAFT") // DRAFT | SENT

  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  doctor      User        @relation("DoctorPrescriptions", fields: [doctorId], references: [id])
  patient     User        @relation("PatientPrescriptions", fields: [patientId], references: [id])

  medicines Medicine[]

  createdAt DateTime @default(now())
}

model Medicine {
  id              Int    @id @default(autoincrement())
  prescriptionId  Int
  name            String
  dosage          String
  duration        String
  notes           String?

  prescription Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
}

model Notification {
  id         Int      @id @default(autoincrement())
  userEmail  String
  message    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
}

model Review {
  id            Int      @id @default(autoincrement())
  appointmentId Int      @unique
  patientId     Int
  doctorId      Int
  
  rating        Int      // 1-5 stars
  comment       String?  // Optional text review
  
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  patient       User        @relation("PatientReviews", fields: [patientId], references: [id])
  doctor        User        @relation("DoctorReviews", fields: [doctorId], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Blog {
  id             Int      @id @default(autoincrement())
  authorName     String
  specialization String?   // nullable for Admin
  title          String
  content        String

  authorRole     Role     // DOCTOR or ADMIN
  createdAt      DateTime @default(now())
}
